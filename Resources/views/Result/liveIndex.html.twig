<html>
<head>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
</head>
<body>

<div id="container" style="width:100%; height:400px;"></div>

</body>
<script type="text/javascript">
    var requestData, animation_data, chart;
    var event_id = {{ event.getId }};
    function cmp(v1, v2){
        if(v1.presentationValue<v2.presentationValue)return -1;
        if(v1.presentationValue>v2.presentationValue)return 1;
        return 0;
    }
    function load(){
        $.getJSON('{{ live_results_url }}', function(data){
            if('presentations' in data){
                var sortMe = [], presentationNames = [], presentationValues = [];
                for(var i in data['presentations']){
                    var pres = {};
                    pres.presentationName = data['presentations'][i]['presentation']['name'];
                    pres.presentationValue = data['presentations'][i]['score']['average'];
                    sortMe.push(pres);
                }
                //sortMe.sort(cmp);
                for(var i in sortMe){
                    presentationNames.push(sortMe[i].presentationName);
                    presentationValues.push(sortMe[i].presentationValue);
                }
                chart.xAxis[0].update({categories: presentationNames}, true);
                chart.series[0].setData(presentationValues, true, true, true);
            }
            setTimeout(load, 5000);
        });
    }


    $(document).ready(function(){

        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                defaultSeriesType: 'column',
                events: {
                    load: function(){
                        setTimeout(load, 1000);
                    }
                }
            },
            plotOptions: {
                column:{
                    colorByPoint: true
                }
            },
            //colors: ['#2f7ed8', '#0d233a', '#8bbc21', '#910000', '#1aadce',
            //    '#492970', '#f28f43', '#77a1e5', '#c42525', '#a6c96a'],
            title: {
                text: 'Live results for {{ event.getName }}'
            },
            xAxis: {
                type: 'String',
                tickPixelInterval: 5
            },
            yAxis: {
                minPadding: 0.1,
                maxPadding: 0.1,
                tickmarkPlacement: 'on',
                min: 0,
                max: 5,
                title: {
                    text: 'Average number of rating score'
                }
            },
            series: [
                {
                    showInLegend: false,
                    data:[],
                    dataLabels: {
                        enabled: true,
                        rotation: 0,
                        formatter: function() {
                            return this.y;
                        },
                        style: {
                            fontSize: '13px'
                        }
                    }
                }]
        });

    });
</script>
</html>