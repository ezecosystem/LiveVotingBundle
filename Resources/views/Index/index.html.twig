{% extends 'LiveVotingBundle::base.html.twig' %}

{% block stylesheets %}
	<link rel="stylesheet" href= "{{ asset('bundles/livevoting/css/normalize.css') }}"  />
{% endblock %}

{% block body %}

{% for flashMessage in app.Session.flashbag.get('message') %}
	<h3>{{flashMessage}}</h3>
{% endfor %}

	<div class="row">
		<div class="col-xs-12">
			<h1>Event voting: {{ event.getName }}</h1>
		</div>
	</div>

	<div class="row">
		<div id="voteScreen"></div>
	</div>

	<div class="row spin-loader" id="loader">
		<div class="col-xs-12">
			<span>
				<i class="fa fa-cog fa-spin"></i>
			</span>
		</div>
	</div>

	<div class="row secondary-footer">
		<div class="col-xs-12">
			<a href="{{ path('user_landing') }}"><button type="button" class="btn"><i class="fa fa-chevron-left"></i>Back to events</button></a>
			{% if event.getAllowViewingResults %}
			<a href="{{ path('result', {'event_id':event.getId}) }}"><button type="button" class="btn"><i class="fa fa-bar-chart"></i>Live results</button></a>
			{% endif %}
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	<script type="text/javascript" src="{{ asset('bundles/livevoting/js/handlebars-v1.3.0.js') }}"></script>
	<script type="text/javascript" src="{{ asset('bundles/livevoting/js/script.js') }}"></script>
	<script src="https://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

	<script type="text/javascript">
			$(document).ready(function(){
					new brain({
							'STATES':{
									'PRE':{'TIMEOUT':1},
									'ACTIVE':{'TIMEOUT':5},
									'POST':{'TIMEOUT':5}
					},
							'URLS':{
									'EVENT_STATUS':'/user/event_status/',
									'VOTE':'/user/vote/'
							}
					});

			});
	</script>
	<script id="presentation" type="text/x-handlebars-template">
			<div class="voting-list-single col-md-6 col-lg-6 col-sm-12 col-xs-12 media">
					<div class='highLight'></div>
					<div class='row'>
					<div class="col-lg-2 col-md-2 col-sm-4 col-xs-4">
							<img src="{{ asset('bundles/livevoting/') }}{{ '{{image}}' }}"
							class='thumbnail slikaa'>
					</div>
					<div class="unutra col-lg-10 col-md-10 col-sm-8 col-xs-8">
							<h4 class="text-info imeprezentera">{{ '{{presenterName}}' }} {{ '{{presenterSurname}}' }}</h4>
							<h3 class="text-info naslovprezentacije"><small>{{ '{{presentationName}}' }}</small></h3>
							<br>
					</div>
					</div>

					<div class='row'>
							<form class="forma col-lg-12 col-md-12 col-sm-12 col-xs-12" action="../user/vote/{{ '{{ presentationId }}' }}" method="POST">

									<span class='glyphicon glyphicon-thumbs-down'></span>
									<div class="btn-group btn-group-lg">

											<input type="submit" class='btn btn-default btn-sm' value='1'/>
											<input type="submit" class='btn btn-default btn-sm' value='2'/>
											<input type="submit" class='btn btn-default btn-sm' value='3'/>
											<input type="submit" class='btn btn-default btn-sm' value='4'/>
											<input type="submit" class='btn btn-default btn-sm' value='5'/>

									</div>

									<span class='glyphicon glyphicon-thumbs-up'></span>
									<br>

							</form>
							{% set path = path('user_comment_presentation', {'presentationId': '{{presentationId}}'}) %}

							{{ form(
								form, {'action': path|replace({'%7B%7B': '{{', '%7D%7D': '}}'}), 'attr': {'class': 'commentPresentation'}}
								) }}

								{% set path2 = path('user_upload_image_presentation', {'presentationId': '{{presentationId}}'}) %}

								{{ form(
									imageForm, {'action': path2|replace({'%7B%7B': '{{', '%7D%7D': '}}'}), 'attr': {'class': 'imageUpload'}}
									) }}
					</div>
			</div>
	</script>

	<script type="text/javascript">

		$('body').on('submit', '.commentPresentation', function(e){
				e.preventDefault();
				var formData = new FormData(this);

				$.ajax({
						type:'POST',
						url: $(this).attr('action'),
						data:formData,
						processData: false,
						contentType: false,
						success:function(data){
								alert('Thank you for commenting!');
						},
						error: function(data){
							alert('error');
						}
				});
				this.reset();
		});

			$('body').on('submit', '.imageUpload', function(e){
				e.preventDefault();
					var formData = new FormData(this);

					$.ajax({
							type:'POST',
							url: $(this).attr('action'),
							data:formData,
							processData: false,
							contentType: false,
							success:function(data){
									alert('Thank you for uploading image!');
							},
							error: function(data){
								alert('error');
							}
					});
					this.reset();
			});


	</script>
{% endblock %}
